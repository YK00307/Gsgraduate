<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>精読篇</title>
        <link rel="stylesheet" href="intermediate.css">

</head>
<body>
  <button onclick="location.href='index.php'">HOMEに戻る</button>
  <button onclick="location.href='advanced.html'">速読モードへ移動</button>
  <h2>下のほうのボタンが見えにくい場合は画面全体を縮小すると見えやすくなります。</h2>
<!-- ①ファイルの入力から -->
<h3>①ファイルをアップロードして英文抽出</h3>
<input type="file" id="fileInputOCR" accept=".txt,.pdf,.docx,.png,.jpg,.jpeg,.gif" />
<div id="fileTextArea" style="white-space:pre-wrap; border:1px solid #ccc; padding:10px; margin-top:10px;
" placeholder="ファイルの入力内容がここに表示されます"></div>
<br>
<textarea id="inputText" placeholder="テキストで入力する場合はここに英文を入力.ファイル入力は出力に30秒ほど時間がかかります。" rows="6" cols="60"></textarea>
<br>
<!-- ②抽出された英文を１文ずつ表示する -->
<button id="extractBtn">英文抽出</button>
<div>
    <button id="hideAllBtn">全体の訳を隠す</button>
</div>

<p>②以下のフィールドに読み取った英文が表示されます</p>
<p>誤字などを直したい場合はフィールドを直してからもう一度抽出してください</p>

<!-- 出力エリア -->
<div id="outputArea" style="margin-top:20px; border:5px solid #ccc; padding:10px;" ></div>

<!-- 単語詳細モーダル -->
<div id="detailModal" style="display:none; position:fixed; top:20%; left:20%; width:60%; background:#fff; border:1px solid #333; padding:20px; z-index:1000;">
    <button id="closeModal" style="float:right;">x</button>
    <h3 id="detailWord"></h3>
    <p id="detailMeaning"></p>
    <p><strong>例文:</strong> <span id="detailSentence"></span></p>
    <button id="AddToMyWordBtn" style="float:right;">My単語帳に追加</button>
</div>
<!-- 音声再生 （全体）-->
<div>
  <br>
  <p>リスニング音源</p>
  <button id="listenBtn">音声作成</button>
  <button id="playBtn">▶ 再生</button>
  <button id="pauseBtn">⏸ 停止</button>
  <button id="resetBtn">⏹ リセット</button>
  <button id="back5">⏪ -5秒</button>
  <button id="forward5">⏩ +5秒</button>
  <label>速度:
    <select id="speedSelect">
      <option value="0.8">0.8x</option>
      <option value="1" selected>1.0x</option>
      <option value="1.2">1.2x</option>
      <option value="1.5">1.5x</option>
    </select>
  </label>
</div>

<audio id="ttsAudio" controls></audio>


<!-- <div id="outputArea2">ここに英文が表示される</div> -->
<br>
<button id="recordBtn">録音する</button>
<button id="recordStopBtn" disabled>停止する</button>
<button id="sendBtn" disabled>提出する</button>

<div id="recordingList"></div>
<div id="feedback"></div>

<!-- <script src="shadowing.js"></script> -->
<script src="intermediate.js"></script>
<script src="Tesseract.js"></script>
<script>
const listenBtn = document.getElementById("listenBtn");
const playBtn = document.getElementById("playBtn");
const pauseBtn = document.getElementById("pauseBtn");
const resetBtn = document.getElementById("resetBtn");
const back5Btn = document.getElementById("back5");
const forward5Btn = document.getElementById("forward5");
const speedSelect = document.getElementById("speedSelect");
const audio = document.getElementById("ttsAudio");


// 音声作成
listenBtn.addEventListener("click", async () => {
  const text = document.getElementById("outputArea").innerText.trim();
  if (!text) {
    alert("先に英文を抽出してください");
    return;
  }

  try {
    const response = await fetch("tts.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    if (!response.ok) throw new Error("TTS APIエラー");

    const arrayBuffer = await response.arrayBuffer();
    const audioBlob = new Blob([arrayBuffer], { type: "audio/mpeg" });
    const audioUrl = URL.createObjectURL(audioBlob);

    audio.src = audioUrl;
    audio.play();
  } catch (err) {
    console.error(err);
    alert("音声生成に失敗しました");
  }
});

// 再生
playBtn.addEventListener("click", () => {
  audio.play();
});

// 一時停止
pauseBtn.addEventListener("click", () => {
  audio.pause();
});

// リセット
resetBtn.addEventListener("click", () => {
  audio.pause();
  audio.currentTime = 0;
});

// -5秒
back5Btn.addEventListener("click", () => {
  audio.currentTime = Math.max(0, audio.currentTime - 5);
});

// +5秒
forward5Btn.addEventListener("click", () => {
  audio.currentTime = Math.min(audio.duration, audio.currentTime + 5);
});

// 再生速度変更
speedSelect.addEventListener("change", () => {
  audio.playbackRate = parseFloat(speedSelect.value);
});
</script>
<style>
  .footer-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #f0f0f0;
    border-top: 1px solid #ccc;
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
  }
  .footer-nav button {
    flex: 1;
    border: none;
    background: none;
    font-size: 16px;
    cursor: pointer;
  }
  .footer-nav button:hover {
    background: #ddd;
  }
</style>

<footer class="footer-nav">
<button onclick="location.href='index.php'">HOME</button>
<button onclick="location.href='select.php'">VOCAB</button>
<button onclick="location.href='intermediate.html'">精読</button>
<button onclick="location.href='advanced.html'">速読</button>
<button onclick="location.href='timeline.php'">TIMELINE</button>
</footer>


  <!-- ① 外部ライブラリ（Tesseract.js） -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

</body>
</html>